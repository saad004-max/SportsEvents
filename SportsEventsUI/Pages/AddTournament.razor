@page "/add-tournament"
@inject HttpClient Http
@inject NavigationManager Nav
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin, Organizer")]

<div class="container" style="max-width: 600px; margin: 40px auto;">

    <h1>Create <span style="color: var(--accent-sport);">Tournament</span></h1>

    <div class="sport-card">
        <EditForm Model="@tournoi" OnValidSubmit="HandleSubmit">

            <div style="margin-bottom: 20px;">
                <label style="display: block; color: var(--text-muted); margin-bottom: 8px;">Tournament Name</label>
                <InputText @bind-Value="tournoi.Nom" placeholder="e.g. Summer Cup 2024"
                           style="width: 100%; padding: 12px; background: #2a2a35; border: 1px solid #444; color: white; border-radius: 8px;" />
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; color: var(--text-muted); margin-bottom: 8px;">Sport</label>
                <InputSelect @bind-Value="tournoi.Sport" style="width: 100%; padding: 12px; background: #2a2a35; border: 1px solid #444; color: white; border-radius: 8px;">
                    <option value="Football">Football</option>
                    <option value="Basketball">Basketball</option>
                    <option value="Tennis">Tennis</option>
                    <option value="Esports">Esports</option>
                </InputSelect>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; color: var(--text-muted); margin-bottom: 8px;">Location</label>
                <InputText @bind-Value="tournoi.Lieu" placeholder="e.g. Central Stadium, New York"
                           style="width: 100%; padding: 12px; background: #2a2a35; border: 1px solid #444; color: white; border-radius: 8px;" />
            </div>

            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                <div style="flex: 1;">
                    <label style="display: block; color: var(--text-muted); margin-bottom: 8px;">Start Date</label>
                    <InputDate @bind-Value="tournoi.DateDebut"
                               style="width: 100%; padding: 12px; background: #2a2a35; border: 1px solid #444; color: white; border-radius: 8px;" />
                </div>

                <div style="flex: 1;">
                    <label style="display: block; color: var(--text-muted); margin-bottom: 8px;">Finish Date</label>
                    <InputDate @bind-Value="tournoi.DateFin"
                               style="width: 100%; padding: 12px; background: #2a2a35; border: 1px solid #444; color: white; border-radius: 8px;" />
                </div>
            </div>

            <div style="text-align: right;">
                <button type="submit" class="btn-primary-sport">
                    <span>Create Event</span>
                </button>
            </div>

        </EditForm>
    </div>
</div>

@code {
    private TournamentCreateDto tournoi = new TournamentCreateDto();

    private async Task HandleSubmit()
    {
        var response = await Http.PostAsJsonAsync("api/Tournoi", tournoi);
        if (response.IsSuccessStatusCode)
        {
            Nav.NavigateTo("/tournaments");
        }
    }

    public class TournamentCreateDto
    {
        public string Nom { get; set; } = "";
        public string Sport { get; set; } = "Football";
        public string Lieu { get; set; } = ""; // Removed "TBD" default so the placeholder shows
        public DateTime DateDebut { get; set; } = DateTime.Today;
        public DateTime DateFin { get; set; } = DateTime.Today.AddDays(7);
        public int NombreEquipesMax { get; set; } = 8;
    }
}